# Diagrama de Arquitectura - Sistema de Temas

## Flujo de ComunicaciÃ³n: UI â†’ ThemeProvider â†’ PreferencesService â†’ Hive

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       UI        â”‚    â”‚  ThemeProvider  â”‚    â”‚PreferencesServiceâ”‚    â”‚    Hive     â”‚
â”‚   (MaterialApp) â”‚    â”‚                 â”‚    â”‚                 â”‚    â”‚ (Database)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚                     â”‚
         â”‚                       â”‚                       â”‚                     â”‚
         â”‚   Consumer<Theme>     â”‚                       â”‚                     â”‚
         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚                     â”‚
         â”‚                       â”‚                       â”‚                     â”‚
         â”‚                       â”‚   getDarkMode()       â”‚                     â”‚
         â”‚                       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚
         â”‚                       â”‚                       â”‚                     â”‚
         â”‚                       â”‚                       â”‚   box.get(key)      â”‚
         â”‚                       â”‚                       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
         â”‚                       â”‚                       â”‚                     â”‚
         â”‚                       â”‚                       â”‚   bool value        â”‚
         â”‚                       â”‚                       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
         â”‚                       â”‚                       â”‚                     â”‚
         â”‚                       â”‚   return bool         â”‚                     â”‚
         â”‚                       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                     â”‚
         â”‚                       â”‚                       â”‚                     â”‚
         â”‚  themeMode: isDark?   â”‚                       â”‚                     â”‚
         â”‚  ThemeMode.dark :     â”‚                       â”‚                     â”‚
         â”‚  ThemeMode.light      â”‚                       â”‚                     â”‚
         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚                     â”‚
```

## Flujo cuando el Usuario Cambia el Tema

### 1. InicializaciÃ³n de la App
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              App Startup                                       â”‚
â”‚                                                                                 â”‚
â”‚  1. main() â†’ WidgetsFlutterBinding.ensureInitialized()                        â”‚
â”‚  2. Hive.initFlutter()                                                         â”‚
â”‚  3. ThemeProvider() constructor ejecuta loadTheme()                            â”‚
â”‚  4. loadTheme() â†’ PreferencesService.getDarkMode()                            â”‚
â”‚  5. PreferencesService â†’ Hive.openBox() â†’ box.get('isDarkMode')               â”‚
â”‚  6. MaterialApp usa Consumer<ThemeProvider> para aplicar tema inicial          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Usuario Cambia el Tema (InteracciÃ³n)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User Action   â”‚
â”‚  (Toggle Theme) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       UI        â”‚    â”‚  ThemeProvider  â”‚    â”‚PreferencesServiceâ”‚    â”‚    Hive     â”‚
â”‚   (Switch/Btn)  â”‚    â”‚                 â”‚    â”‚                 â”‚    â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚                     â”‚
         â”‚                       â”‚                       â”‚                     â”‚
         â”‚ 1. onTap()            â”‚                       â”‚                     â”‚
         â”‚ toggleTheme()         â”‚                       â”‚                     â”‚
         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                       â”‚                     â”‚
         â”‚                       â”‚                       â”‚                     â”‚
         â”‚                       â”‚ 2. _isDarkMode =      â”‚                     â”‚
         â”‚                       â”‚    !_isDarkMode       â”‚                     â”‚
         â”‚                       â”‚                       â”‚                     â”‚
         â”‚                       â”‚ 3. setDarkMode(bool)  â”‚                     â”‚
         â”‚                       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚
         â”‚                       â”‚                       â”‚                     â”‚
         â”‚                       â”‚                       â”‚ 4. box.put(key,val) â”‚
         â”‚                       â”‚                       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
         â”‚                       â”‚                       â”‚                     â”‚
         â”‚                       â”‚                       â”‚ 5. âœ… Saved         â”‚
         â”‚                       â”‚                       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
         â”‚                       â”‚                       â”‚                     â”‚
         â”‚                       â”‚ 6. await complete     â”‚                     â”‚
         â”‚                       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                     â”‚
         â”‚                       â”‚                       â”‚                     â”‚
         â”‚                       â”‚ 7. notifyListeners()  â”‚                     â”‚
         â”‚                       â”‚                       â”‚                     â”‚
         â”‚ 8. Consumer rebuilds  â”‚                       â”‚                     â”‚
         â”‚    with new theme     â”‚                       â”‚                     â”‚
         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚                     â”‚
         â”‚                       â”‚                       â”‚                     â”‚
         â”‚ 9. UI actualizada     â”‚                       â”‚                     â”‚
         â”‚    con nuevo tema     â”‚                       â”‚                     â”‚
```

## Detalles de ImplementaciÃ³n

### ThemeProvider (Estado Global)
```dart
class ThemeProvider with ChangeNotifier {
  bool _isDarkMode = false;
  
  // Carga tema guardado al inicializar
  ThemeProvider() {
    loadTheme();
  }
  
  // Alterna tema y persiste cambio
  void toggleTheme() async {
    _isDarkMode = !_isDarkMode;
    await PreferencesService.setDarkMode(_isDarkMode);
    notifyListeners(); // ğŸ”„ Notifica a todos los Consumer
  }
}
```

### PreferencesService (Capa de Persistencia)
```dart
class PreferencesService {
  // Guarda en Hive
  static Future<void> setDarkMode(bool isDark) async {
    final box = await Hive.openBox('preferences_box');
    await box.put('isDarkMode', isDark);
  }
  
  // Lee desde Hive
  static Future<bool> getDarkMode() async {
    final box = await Hive.openBox('preferences_box');
    return box.get('isDarkMode', defaultValue: false);
  }
}
```

### MaterialApp (UI Reactiva)
```dart
MaterialApp(
  theme: AppTheme.theme,        // Tema claro
  darkTheme: ThemeData.dark(),  // Tema oscuro
  themeMode: themeProvider.isDarkMode ? ThemeMode.dark : ThemeMode.light,
  // ğŸ‘† Se actualiza automÃ¡ticamente cuando ThemeProvider notifica cambios
)
```


## Flujo de Datos (Resumen)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                 â”‚
â”‚  UI (Consumer) â—„â”€â”€â”€ notifyListeners() â—„â”€â”€â”€ ThemeProvider                      â”‚
â”‚       â”‚                                         â”‚                              â”‚
â”‚       â”‚                                         â”‚                              â”‚
â”‚       â””â”€â”€â”€ toggleTheme() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                              â”‚
â”‚                                                 â”‚                              â”‚
â”‚                                                 â–¼                              â”‚
â”‚                                    PreferencesService                          â”‚
â”‚                                                 â”‚                              â”‚
â”‚                                                 â–¼                              â”‚
â”‚                                            Hive Database                       â”‚
â”‚                                        (Almacenamiento Local)                  â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```